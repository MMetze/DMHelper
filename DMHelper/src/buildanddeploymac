echo Building DM Helper for MAC

export PATH=$PATH:$HOME/Qt/5.13.2/clang_64/bin

cd ..
rm -R build-clang_64bit-Release
rm -R bin64
rm "DM Helper macOS release.zip"
mkdir build-clang_64bit-Release
mkdir bin64
cd build-clang_64bit-Release
qmake ../src/DMHelper.pro -spec macx-clang CONFIG+=x86_64 CONFIG+=qtquickcompiler
make -j4

cp -R DMHelper.app/ ../bin64/DMHelper.app/
cp ../src/binsrcmac/Info.plist ../bin64/DMHelper.app/Contents/

cd ../bin64
mkdir DMHelper.app/Contents/Frameworks
cp -R ../src/vlc/VLCKit.framework DMHelper.app/Contents/Frameworks/VLCKit.framework
otool -L DMHelper.app/Contents/MacOS/DMHelper
install_name_tool -id @executable_path/../Frameworks/VLCKit.framework/Versions/A/VLCKit DMHelper.app/Contents/Frameworks/VLCKit.framework/Versions/A/VLCKit
install_name_tool -change @loader_path/../Frameworks/VLCKit.framework/Versions/A/VLCKit @executable_path/../Frameworks/VLCKit.framework/Versions/A/VLCKit DMHelper.app/Contents/MacOS/DMHelper
otool -L DMHelper.app/Contents/MacOS/DMHelper

cd ../build-clang_64bit-Release

macdeployqt ../bin64/DMHelper.app/

cp -R ../src/bestiary/ ../bin64/DMHelper.app/Contents/Resources
cp -R ../src/resources/ ../bin64/DMHelper.app/Contents/Resources
cp -R ../src/doc/ ../bin64/DMHelper.app/Contents/Resources
cp ../src/binsrcmac/DMHelper.icns ../bin64/DMHelper.app/Contents/Resources

cd ../bin64

zip -r "DM Helper macOS release.zip" *

mv "DM Helper macOS release.zip" ../


